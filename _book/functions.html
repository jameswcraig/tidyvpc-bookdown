<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Functions | Introduction to tidyvpc</title>
  <meta name="description" content="VPC Percentiles and Prediction Intervals" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Functions | Introduction to tidyvpc" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="VPC Percentiles and Prediction Intervals" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Functions | Introduction to tidyvpc" />
  
  <meta name="twitter:description" content="VPC Percentiles and Prediction Intervals" />
  

<meta name="author" content="James Craig" />


<meta name="date" content="2020-04-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="advanced.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to tidyvpc</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Installation</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#cran"><i class="fa fa-check"></i><b>1.1</b> CRAN</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#development-version-from-github"><i class="fa fa-check"></i><b>1.2</b> Development version from GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#preprocessing-data"><i class="fa fa-check"></i><b>2.1.1</b> Preprocessing data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#observed"><i class="fa fa-check"></i><b>3.1</b> <code>observed()</code></a></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#simulated"><i class="fa fa-check"></i><b>3.2</b> <code>simulated()</code></a></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#binning"><i class="fa fa-check"></i><b>3.3</b> <code>binning()</code></a></li>
<li class="chapter" data-level="3.4" data-path="functions.html"><a href="functions.html#binless"><i class="fa fa-check"></i><b>3.4</b> <code>binless()</code></a></li>
<li class="chapter" data-level="3.5" data-path="functions.html"><a href="functions.html#vpcstats"><i class="fa fa-check"></i><b>3.5</b> <code>vpcstats()</code></a></li>
<li class="chapter" data-level="3.6" data-path="functions.html"><a href="functions.html#stratify"><i class="fa fa-check"></i><b>3.6</b> <code>stratify()</code></a></li>
<li class="chapter" data-level="3.7" data-path="functions.html"><a href="functions.html#censoring"><i class="fa fa-check"></i><b>3.7</b> <code>censoring()</code></a></li>
<li class="chapter" data-level="3.8" data-path="functions.html"><a href="functions.html#predcorrect"><i class="fa fa-check"></i><b>3.8</b> <code>predcorrect()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>4</b> Advanced</a><ul>
<li class="chapter" data-level="4.1" data-path="advanced.html"><a href="advanced.html#binning-by-strata"><i class="fa fa-check"></i><b>4.1</b> Binning by Strata</a></li>
<li class="chapter" data-level="4.2" data-path="advanced.html"><a href="advanced.html#binless-by-strata"><i class="fa fa-check"></i><b>4.2</b> Binless by Strata</a></li>
<li class="chapter" data-level="4.3" data-path="advanced.html"><a href="advanced.html#visualize-bins"><i class="fa fa-check"></i><b>4.3</b> Visualize Bins</a></li>
<li class="chapter" data-level="4.4" data-path="advanced.html"><a href="advanced.html#bin-information"><i class="fa fa-check"></i><b>4.4</b> Bin Information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>5</b> Extending Further with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2.html"><a href="ggplot2.html#plot-vpc"><i class="fa fa-check"></i><b>5.1</b> Plot VPC</a></li>
<li class="chapter" data-level="5.2" data-path="ggplot2.html"><a href="ggplot2.html#plot-rectangles"><i class="fa fa-check"></i><b>5.2</b> Plot Rectangles</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2.html"><a href="ggplot2.html#plot-below-quantification-limit-bql"><i class="fa fa-check"></i><b>5.3</b> Plot Below Quantification Limit (BQL)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jameswcraig/tidyvpc" target="blank">GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to tidyvpc</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Functions</h1>
<div id="observed" class="section level2">
<h2><span class="header-section-number">3.1</span> <code>observed()</code></h2>
<p>The <code>observed()</code> function is always the first function used in the VPC piping chain and is used to specify the observed dataset and corresponding variables. There are three arguments that are required in order to use <code>observed</code>. The first argument is either a <code>data.frame</code> or <code>data.table</code>, the second argument is the name of x-variable in the observed data, and the third argument is the name of the y-variable. Note variable names should be unquoted.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x =</span> TIME, <span class="dt">y =</span> DV)</a></code></pre></div>
</div>
<div id="simulated" class="section level2">
<h2><span class="header-section-number">3.2</span> <code>simulated()</code></h2>
<p>The <code>simulated()</code> function is used to specify the simulated dataset and corresponding variables. There are two arguments that are required in order to use <code>simulated()</code>. Since the function is “piped” in after the <code>observed()</code> function, the first argument is the tidyvpcobj and should not be included, followed by the name of the simulated data, then the name of y-variable in the simulated data. Variable names should be unquoted and x-variable should not be included as it is recycled from the <code>observed()</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x =</span> TIME, <span class="dt">y =</span> DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">simulated</span>(sim_data, <span class="dt">y =</span> DV)</a></code></pre></div>
</div>
<div id="binning" class="section level2">
<h2><span class="header-section-number">3.3</span> <code>binning()</code></h2>
<p>The <code>binning()</code> function provides the binning method to derive the vpc and should be inputted as a character string in the <code>bin</code> argument. Binning methods include: “ntile”, “pam”, “sd”, “equal”, “pretty”, “quantile”, “kmeans”, “jenks”, “centers”, “breaks”. Some methods such as “ntile” and “pam” will require you to specify the number of bins using the <code>nbins</code> argument i.e. <code>nbins = 9</code>.</p>
<p>If using <code>bin = "centers"</code> or <code>bin = "breaks</code> you must also provide the centers/breaks argument as numeric vector in the function i.e. <code>centers = c(1,3,5,7)</code>.</p>
<p>You can also bin directly on x-variable. If using this type of binning, the bin argument should be the unquoted variable name that you used in the <code>observed()</code> function i.e. <code>bin = NTIME</code> for the Nominal Time variable in the data.</p>
<p>Binning on x-variable, NTIME</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> NTIME)</a></code></pre></div>
<p>Binning with “ntile”</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x =</span> TIME, <span class="dt">y =</span> DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="st">  </span><span class="kw">simulated</span>(sim_data, <span class="dt">y =</span> DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">  </span><span class="kw">binning</span>(<span class="dt">bin =</span> <span class="st">&quot;ntile&quot;</span>, <span class="dt">nbins =</span> <span class="dv">9</span>)</a></code></pre></div>
<p>Binning with “breaks”</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x =</span> TIME, <span class="dt">y =</span> DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw">simulated</span>(sim_data, <span class="dt">y =</span> DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="st">  </span><span class="kw">binning</span>(<span class="dt">bin =</span> <span class="st">&quot;breaks&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>))</a></code></pre></div>
</div>
<div id="binless" class="section level2">
<h2><span class="header-section-number">3.4</span> <code>binless()</code></h2>
<p>Binless methods utilize additive quantile regression (AQR) in place of traditional binning. Use the <code>binless()</code> function instead of <code>binning()</code> to derive a binless VPC. By default, <code>binless()</code> performs AQR at the 5%, 50%, and 95% quantiles but you can change this using the <code>qpred</code> argument which takes a numeric vector of length 3 i.e. <code>qpred =  c(.1, .5, .9)</code> for the 10%, 50%, 90% quantiles.</p>
<p>The lambda smoothing parameters for each quantile are optimized by default with AIC as indicated by the <code>optimize = TRUE</code> argument, however, if you would like to use different lambda values for each quantile set <code>optimize = FALSE</code> and specify lambda values for each quantile as a numeric vector of length 3 with the <code>lambda</code> argument i.e. <code>lambda = c(1,3,2)</code> corresponds to the lambda values for the quantiles in the <code>qpred</code> argument (lower, median, upper). Note: the higher the lambda value the smoother fit to the data.</p>
<p>Binless optimized</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="st">    </span><span class="kw">binless</span>()</a></code></pre></div>
<p>Binless with user specified lambda values at 10%, 50%, 90% quantiles. Set <code>optimize = FALSE</code> and provide lambda smoothing parameters as a vector of length 3 for lower, median, upper quantiles.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="st">    </span><span class="kw">binless</span>(<span class="dt">qpred =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>), <span class="dt">optimize =</span> <span class="ot">FALSE</span>, <span class="dt">lambda =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>))</a></code></pre></div>
</div>
<div id="vpcstats" class="section level2">
<h2><span class="header-section-number">3.5</span> <code>vpcstats()</code></h2>
<p>The <code>vpcstats()</code> function is always the final function used in the piping chain and calculates the statistics needed to plot a VPC. If using <code>binning()</code>methods, you may specify alternative quantiles using the <code>qpred</code> argument. The default quantiles used are 5%, 50%, 95% i.e. <code>qpred = c(0.05, 0.5, 0.95)</code>. If using <code>binless()</code> method, there is no need to include the <code>qpred()</code> argument here as the quantile values supplied in the <code>binless()</code> function will be used to calculate the VPC statistics for plotting.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> NTIME) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/vpcstats-1.png" width="640" /></p>
</div>
<div id="stratify" class="section level2">
<h2><span class="header-section-number">3.6</span> <code>stratify()</code></h2>
<p>To stratify VPC include the <code>stratify()</code> function before using the <code>binning()</code> or <code>binless()</code> function and use the unquoted stratification variable(s) name as a formula. Let’s stratify on <code>GENDER</code> in the data, which contains 2 levels (GENDER = “M”, GENDER = “F”). Include as many stratification variables as your model calls for.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">    </span><span class="kw">stratify</span>(<span class="op">~</span><span class="st"> </span>GENDER) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> <span class="st">&quot;pam&quot;</span>, <span class="dt">nbins =</span> <span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb16-6" title="6"></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/stratify-1.png" width="640" /></p>
<p>Using multiple stratification variables <code>GENDER</code> and <code>STUDY</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">    </span><span class="kw">stratify</span>(<span class="op">~</span><span class="st"> </span>GENDER <span class="op">+</span><span class="st"> </span>STUDY) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">    </span><span class="kw">binless</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-13-1.png" width="640" /></p>
</div>
<div id="censoring" class="section level2">
<h2><span class="header-section-number">3.7</span> <code>censoring()</code></h2>
<p>To censor observed data below lower limit of quantification (LLOQ), include the <code>censoring()</code> function after <code>simulated()</code> and use the <code>lloq</code> argument to specify either a variable in the data or specific value for censoring. The <code>blq</code> argument creates a logical TRUE/FALSE in the data that indicates whether the value is below the limit of quantification and is typically defined as rows with DV &lt; LLOQ in the data. Using the <code>censoring()</code> function will censor only observed data below lower limit of quantification when plotting, simulated data will still be plotted.</p>
<p>Censoring using numeric value.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="st">    </span><span class="kw">censoring</span>(<span class="dt">blq=</span>(DV <span class="op">&lt;</span><span class="st"> </span><span class="dv">25</span>), <span class="dt">lloq=</span><span class="dv">25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">nbins =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb18-6" title="6"></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-14-1.png" width="640" /></p>
<p>Censoring using <code>LLOQ</code> variable in the data.</p>
<p>First, let’s add an LLOQ variable to the observed data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">obs_data<span class="op">$</span>LLOQ &lt;-<span class="st"> </span><span class="dv">50</span></a></code></pre></div>
<p>Then we’ll specify lower limit of quantification as the unquoted variable name in our data <code>LLOQ</code>. Let’s also provide our own lambda values.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="st">    </span><span class="kw">censoring</span>(<span class="dt">blq=</span>(DV <span class="op">&lt;</span><span class="st"> </span>LLOQ), <span class="dt">lloq=</span>LLOQ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="st">    </span><span class="kw">binless</span>(<span class="dt">optimize =</span> <span class="ot">FALSE</span>, <span class="dt">lambda =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">1.7</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-16-1.png" width="640" /></p>
<p>The <code>tidyvpc</code> package also allows you to use different LLOQ for each level of stratification variable. We’ll set an <code>LLOQ</code> value of <code>50</code> for <code>Study A</code> and <code>25</code> for <code>Study B</code> and calculate statistics at 5%, 50%, 90% quantiles.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">obs_data<span class="op">$</span>LLOQ &lt;-<span class="st"> </span><span class="kw">ifelse</span>(obs_data<span class="op">$</span>STUDY <span class="op">==</span><span class="st"> &quot;Study A&quot;</span>, <span class="dv">50</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb21-2" title="2"></a>
<a class="sourceLine" id="cb21-3" title="3">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="st">    </span><span class="kw">censoring</span>(<span class="dt">blq=</span>(DV <span class="op">&lt;</span><span class="st"> </span>LLOQ), <span class="dt">lloq=</span>LLOQ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="st">    </span><span class="kw">stratify</span>(<span class="op">~</span><span class="st"> </span>STUDY) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> <span class="st">&quot;pam&quot;</span>, <span class="dt">nbins =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="st">    </span><span class="kw">vpcstats</span>(<span class="dt">qpred =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>))</a>
<a class="sourceLine" id="cb21-9" title="9"></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-17-1.png" width="640" /></p>
</div>
<div id="predcorrect" class="section level2">
<h2><span class="header-section-number">3.8</span> <code>predcorrect()</code></h2>
<p>To derive a prediction corrected VPC (pcVPC) use the <code>predcorrect()</code> function. The <code>predcorrect()</code> function takes one required argument <code>pred</code> which should be the unquoted variable name of the population prediction variable in the data. If using binning methods, the <code>predcorrect()</code> function should be called <em>after</em> <code>binning()</code>, however, if performing LOESS pcVPC for <code>binless()</code> methods, use <code>predcorrect()</code> <em>before</em> calling <code>binless()</code> and set <code>binless(loess.ypc = TRUE)</code>. Note: if model was fit using log scale of DV make sure to include the argument <code>log = TRUE</code> in <code>predcorrect()</code> to perform the appropriate prediction correction calculation.</p>
<p>Prediction corrected using binning methods.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="st">    </span><span class="kw">stratify</span>(<span class="op">~</span>GENDER) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="st">    </span><span class="kw">binning</span>(<span class="dt">bin =</span> NTIME) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="st">    </span><span class="kw">predcorrect</span>(<span class="dt">pred=</span>PRED) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb22-7" title="7"></a>
<a class="sourceLine" id="cb22-8" title="8"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-18-1.png" width="640" /></p>
<p>LOESS prediction corrected using binless method for 10%, 50%, 90% quantiles. If <code>optimize = TRUE</code>, the LOESS smoothing parameter, span, will be automatically optimize using AIC. Note: <code>predcorrect()</code> must be called before <code>binless()</code> if setting <code>loess.ypc = TRUE</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="st">    </span><span class="kw">stratify</span>(<span class="op">~</span>GENDER) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="st">    </span><span class="kw">predcorrect</span>(<span class="dt">pred=</span>PRED) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="st">    </span><span class="kw">binless</span>(<span class="dt">qpred =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>), <span class="dt">optimize =</span> <span class="ot">TRUE</span>, <span class="dt">loess.ypc =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb23-7" title="7"></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-19-1.png" width="640" /></p>
<p>To specify your own span value LOESS pcVPC instead of optimizing with AIC, use the <code>span</code> argument in the <code>binless</code> function. Span should be a numeric between [0,1], with higher values providing a smoother fit. Remember, to also include the smoothing parameters for AQR by using the <code>lambda</code> argument and set <code>optimize = FALSE</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">vpc &lt;-<span class="st"> </span><span class="kw">observed</span>(obs_data, <span class="dt">x=</span>TIME, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">    </span><span class="kw">simulated</span>(sim_data, <span class="dt">y=</span>DV) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">    </span><span class="kw">predcorrect</span>(<span class="dt">pred=</span>PRED) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">    </span><span class="kw">binless</span>(<span class="dt">optimize =</span> <span class="ot">FALSE</span>, <span class="dt">lambda =</span> <span class="kw">c</span>(.<span class="dv">95</span>,<span class="dv">3</span>,<span class="fl">1.2</span>), <span class="dt">loess.ypc =</span> <span class="ot">TRUE</span>, <span class="dt">span =</span> <span class="fl">.6</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="st">    </span><span class="kw">vpcstats</span>()</a>
<a class="sourceLine" id="cb24-6" title="6"></a>
<a class="sourceLine" id="cb24-7" title="7"><span class="kw">plot</span>(vpc)</a></code></pre></div>
<p><img src="tidyvpc_bookdown_files/figure-html/unnamed-chunk-20-1.png" width="640" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["tidyvpc_bookdown.pdf", "tidyvpc_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
